<!doctype html>
<html>

<head>
  <title>v-grid Code Examples â€“ Formatting data</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="../demo.css">
  <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="common.html">
</head>

<body>
  <section>
    <h1><a href="./">v-grid</a>
      <span>Row Details</span>
    </h1>
    <table-of-contents select="h3" class="toc"></table-of-contents>
  </section>

  <section>
    <h3>Row details</h3>
    <p>The <code>v-grid</code> can on request show any content below any row,
    e.g. detailed information about the row contents.</p>
    <code-example source>
      <v-grid demo>
        <table>
          <colgroup>
            <col name="user.name.first" header-text="First Name">
            <col name="user.name.last" header-text="Last Name">
            <col name="user.email" header-text="Email" flex>
          </colgroup>
        </table>
      </v-grid>
      <code demo-var="grid">
        var grid = grid || document.querySelector("v-grid");

        HTMLImports.whenReady(function() {
          var dataSourceSize = 1000;
          grid.data.source = function(req) {
            // Fetch the JSON data from a URL
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
              if (xhr.readyState == XMLHttpRequest.DONE ) {
                if(xhr.status == 200){
                  var json = JSON.parse(xhr.responseText);
                  req.success(json.results, dataSourceSize);
                }
              }
            }
            var rowsNeeded = req.count > 0 ? req.count : 10;
            xhr.open("GET", "http://api.randomuser.me/?results=" + rowsNeeded, true);
            xhr.send();
          };

          // code
          // Add a row details generator
          grid.rowDetailsGenerator = function(rowIndex) {
            var elem = document.createElement('div');

            grid.data.getItem(rowIndex, function(error, item) {
              // TODO
              elem.textContent = item;
            });

            return elem;
          }

          var detailsOpenIndex = -1;
          
          // Show details for the selected row
          grid.addEventListener('select', function() {
            var selected = grid.selection.selected();
            if(selected.length == 1) {
              grid.setRowDetailsVisible(selected[0], true);
              detailsOpenIndex = selected[0];
            }
          });
          // end-code
        });
      </code>
    </code-example>
  </section>
</body>

</html>
